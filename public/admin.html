<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø°Ù„ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --green: #24775b;
        --green-dark: #1a5742;
        --green-light: #3a9e7a;
        --gold: #b07d2e;
        --gold-light: #d4a03a;
        --bg: #f7f9f8;
        --deep: #f7f9f8;
        --deep2: #eef2f0;
        --card: #ffffff;
        --card2: rgba(36, 119, 91, 0.04);
        --red: #e74c3c;
        --blue: #3498db;
        --text: #1a2e25;
        --text-mid: #3d5c4f;
        --muted: #7a9e90;
        --white: #ffffff;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Cairo", sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
      }

      /* Login */
      .login-wrap {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }
      .login-box {
        background: var(--white);
        border: 1px solid rgba(36, 119, 91, 0.15);
        border-radius: 20px;
        padding: 40px;
        width: 100%;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 8px 40px rgba(36, 119, 91, 0.1);
      }
      .login-box h2 {
        color: var(--green);
        margin-bottom: 24px;
        font-size: 1.5rem;
      }

      /* Layout */
      .layout {
        display: flex;
        min-height: 100vh;
      }
      .sidebar {
        width: 240px;
        background: var(--white);
        border-left: 1px solid rgba(36, 119, 91, 0.1);
        padding: 20px 0;
        flex-shrink: 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        left: 0;
        top: 0;
        box-shadow: 4px 0 20px rgba(36, 119, 91, 0.06);
      }
      .sidebar-logo {
        text-align: center;
        padding: 16px 20px 24px;
        border-bottom: 1px solid rgba(36, 119, 91, 0.1);
        margin-bottom: 16px;
      }
      .sidebar-logo .moon {
        font-size: 2rem;
      }
      .sidebar-logo h3 {
        font-size: 0.9rem;
        color: var(--green);
        margin-top: 6px;
      }
      .nav-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
        color: var(--muted);
        margin: 2px 8px;
        border-radius: 10px;
      }
      .nav-item:hover {
        background: rgba(36, 119, 91, 0.06);
        color: var(--text);
      }
      .nav-item.active {
        background: rgba(36, 119, 91, 0.1);
        color: var(--green);
      }
      .nav-icon {
        font-size: 1.1rem;
      }

      .main {
        margin-right: 240px;
        padding: 24px;
      }
      .page {
        display: none;
      }
      .page.active {
        display: block;
      }

      /* Stats cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }
      .stat-card {
        background: var(--white);
        border: 1px solid rgba(36, 119, 91, 0.1);
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 12px rgba(36, 119, 91, 0.06);
      }
      .stat-card .val {
        font-size: 2rem;
        font-weight: 700;
        color: var(--green);
      }
      .stat-card .lbl {
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 4px;
      }

      /* Table */
      .table-wrap {
        background: var(--white);
        border: 1px solid rgba(36, 119, 91, 0.1);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(36, 119, 91, 0.06);
      }
      .table-header {
        padding: 16px 20px;
        border-bottom: 1px solid rgba(36, 119, 91, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .table-header h3 {
        color: var(--green);
        font-size: 1rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th {
        padding: 12px 16px;
        text-align: right;
        font-size: 0.8rem;
        color: var(--muted);
        background: rgba(36, 119, 91, 0.04);
        border-bottom: 1px solid rgba(36, 119, 91, 0.08);
      }
      td {
        padding: 12px 16px;
        font-size: 0.85rem;
        border-bottom: 1px solid rgba(36, 119, 91, 0.05);
      }
      tr:hover td {
        background: rgba(36, 119, 91, 0.03);
      }

      /* Medal */
      .rank-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        font-size: 0.75rem;
        font-weight: 700;
      }
      .rank-1 {
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: #000;
      }
      .rank-2 {
        background: linear-gradient(135deg, #c0c0c0, #a0a0a0);
        color: #000;
      }
      .rank-3 {
        background: linear-gradient(135deg, #cd7f32, #8b4513);
        color: #fff;
      }
      .rank-other {
        background: rgba(36, 119, 91, 0.06);
        color: var(--muted);
      }

      .points-badge {
        display: inline-block;
        padding: 3px 12px;
        background: rgba(36, 119, 91, 0.1);
        color: var(--green);
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.85rem;
      }

      /* Form */
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }
      .form-group {
        margin-bottom: 16px;
      }
      label {
        display: block;
        font-size: 0.8rem;
        color: var(--muted);
        margin-bottom: 6px;
        font-weight: 600;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 11px 14px;
        background: rgba(36, 119, 91, 0.04);
        border: 1px solid rgba(36, 119, 91, 0.15);
        border-radius: 10px;
        color: var(--text);
        font-family: "Cairo", sans-serif;
        font-size: 0.9rem;
        outline: none;
        transition: border-color 0.2s;
        text-align: right;
        direction: rtl;
      }
      input:focus,
      select:focus,
      textarea:focus {
        border-color: var(--green);
      }
      textarea {
        resize: vertical;
        min-height: 80px;
      }
      select option {
        background: var(--white);
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        font-family: "Cairo", sans-serif;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .btn-gold {
        background: linear-gradient(135deg, var(--green), var(--green-light));
        color: #fff;
      }
      .btn-gold:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }
      .btn-danger {
        background: rgba(231, 76, 60, 0.2);
        color: var(--red);
        border: 1px solid rgba(231, 76, 60, 0.3);
      }
      .btn-danger:hover {
        background: rgba(231, 76, 60, 0.3);
      }
      .btn-blue {
        background: rgba(52, 152, 219, 0.2);
        color: var(--blue);
        border: 1px solid rgba(52, 152, 219, 0.3);
      }
      .btn-sm {
        padding: 6px 14px;
        font-size: 0.8rem;
      }
      .btn-outline {
        background: transparent;
        border: 1px dashed rgba(36, 119, 91, 0.3);
        color: var(--green);
      }
      .btn-outline:hover {
        background: rgba(36, 119, 91, 0.06);
      }

      .day-tabs {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }
      .day-tab {
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.8rem;
        cursor: pointer;
        background: rgba(36, 119, 91, 0.04);
        color: var(--muted);
        border: 1px solid transparent;
        transition: all 0.2s;
      }
      .day-tab.active {
        background: rgba(36, 119, 91, 0.1);
        color: var(--green);
        border-color: rgba(36, 119, 91, 0.25);
      }
      .day-tab:hover {
        color: var(--text);
      }

      .section-card {
        background: var(--white);
        border: 1px solid rgba(36, 119, 91, 0.1);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 12px rgba(36, 119, 91, 0.06);
      }
      .section-title {
        color: var(--green);
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 16px;
      }

      .correct-badge {
        display: inline-block;
        padding: 2px 10px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 700;
      }
      .cat-quran {
        background: rgba(46, 204, 113, 0.15);
        color: var(--green);
      }
      .cat-ramadan {
        background: rgba(176, 125, 46, 0.15);
        color: var(--gold);
      }
      .cat-general {
        background: rgba(52, 152, 219, 0.15);
        color: var(--blue);
      }

      .type-badge {
        display: inline-block;
        padding: 2px 10px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 700;
        margin-right: 6px;
      }
      .type-mcq {
        background: rgba(52, 152, 219, 0.15);
        color: var(--blue);
      }
      .type-tf {
        background: rgba(155, 89, 182, 0.15);
        color: #9b59b6;
      }
      .type-fb {
        background: rgba(230, 126, 34, 0.15);
        color: #e67e22;
      }

      .settings-row {
        display: flex;
        gap: 16px;
        align-items: flex-end;
      }
      .settings-row .form-group {
        flex: 1;
        margin: 0;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--muted);
      }
      .empty-state .icon {
        font-size: 3rem;
        margin-bottom: 12px;
      }

      /* Dynamic options */
      .option-entry {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
      }
      .option-entry input {
        flex: 1;
      }
      .option-entry .remove-opt {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: 1px solid rgba(231, 76, 60, 0.3);
        background: rgba(231, 76, 60, 0.1);
        color: var(--red);
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: all 0.2s;
      }
      .option-entry .remove-opt:hover {
        background: rgba(231, 76, 60, 0.25);
      }
      .option-entry .opt-radio {
        flex-shrink: 0;
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: var(--green);
      }

      /* Responsive */
      @media (max-width: 900px) {
        .sidebar {
          position: fixed;
          bottom: 0;
          top: auto;
          left: 0;
          right: 0;
          width: 100%;
          height: auto;
          display: flex;
          flex-direction: row;
          overflow-x: auto;
          overflow-y: hidden;
          padding: 0;
          z-index: 100;
          border-left: none;
          border-top: 1px solid rgba(36, 119, 91, 0.1);
          box-shadow: 0 -4px 20px rgba(36, 119, 91, 0.08);
        }
        .sidebar-logo {
          display: none;
        }
        .nav-item {
          flex-direction: column;
          gap: 2px;
          padding: 10px 14px;
          margin: 0;
          border-radius: 0;
          font-size: 0.7rem;
          white-space: nowrap;
          min-width: fit-content;
        }
        .nav-icon {
          font-size: 1.2rem;
        }
        .main {
          margin-right: 0;
          padding: 16px;
          padding-bottom: 80px;
        }
        .layout {
          flex-direction: column;
        }
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .form-row {
          grid-template-columns: 1fr;
        }
        .settings-row {
          flex-direction: column;
          gap: 12px;
        }
        .settings-row .form-group {
          width: 100%;
        }
        .table-wrap {
          overflow-x: auto;
        }
        table {
          min-width: 500px;
        }
      }
      @media (max-width: 480px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .main {
          padding: 10px;
          padding-bottom: 80px;
        }
        h2 {
          font-size: 1.2rem;
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(36, 119, 91, 0.2);
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <!-- LOGIN -->
    <div id="loginWrap" class="login-wrap">
      <div class="login-box">
        <div style="font-size: 3rem">ğŸŒ™</div>
        <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</h2>
        <div class="form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input
            type="password"
            id="adminPass"
            placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø´Ø±Ù"
            onkeydown="if (event.key === 'Enter') doLogin();"
          />
        </div>
        <button class="btn btn-gold" style="width: 100%" onclick="doLogin()">
          Ø¯Ø®ÙˆÙ„
        </button>
        <p
          id="loginErr"
          style="
            color: var(--red);
            font-size: 0.8rem;
            margin-top: 10px;
            display: none;
          "
        >
          ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©
        </p>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" style="display: none">
      <div class="layout">
        <div class="sidebar">
          <div class="sidebar-logo">
            <div class="moon">Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙˆÙ‡ÙŠØ¯</div>
            <h3>Ù…Ø³Ø§Ø¨Ù‚Ø© ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø°Ù„ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</h3>
          </div>
          <div class="nav-item active" onclick="showPage('overview')">
            <span class="nav-icon">ğŸ“Š</span> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
          </div>
          <div class="nav-item" onclick="showPage('questions')">
            <span class="nav-icon">â“</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
          </div>
          <div class="nav-item" onclick="showPage('leaderboard')">
            <span class="nav-icon">ğŸ†</span> Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†
          </div>
          <div class="nav-item" onclick="showPage('participants')">
            <span class="nav-icon">ğŸ‘¥</span> Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†
          </div>
          <div class="nav-item" onclick="showPage('settings')">
            <span class="nav-icon">âš™ï¸</span> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          </div>
          <div class="nav-item" onclick="exportData()" style="margin-top: auto">
            <span class="nav-icon">ğŸ“¥</span> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          </div>
        </div>

        <div class="main">
          <!-- Overview -->
          <div id="page-overview" class="page active">
            <h2 style="color: var(--green); margin-bottom: 20px">
              Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© ğŸ“Š
            </h2>
            <div class="stats-grid" id="statsGrid">
              <div class="stat-card">
                <div class="val" id="st-participants">-</div>
                <div class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</div>
              </div>
              <div class="stat-card">
                <div class="val" id="st-today">-</div>
                <div class="lbl">Ù…Ø´Ø§Ø±ÙƒÙˆ Ø§Ù„ÙŠÙˆÙ…</div>
              </div>
              <div class="stat-card">
                <div class="val" id="st-answers">-</div>
                <div class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</div>
              </div>
              <div class="stat-card">
                <div class="val" id="st-accuracy">-</div>
                <div class="lbl">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</div>
              </div>
            </div>
            <div class="table-wrap">
              <div class="table-header"><h3>ğŸ† Ø£ÙØ¶Ù„ Ù¡Ù  Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3></div>
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                  </tr>
                </thead>
                <tbody id="topTable"></tbody>
              </table>
            </div>
          </div>

          <!-- Questions -->
          <div id="page-questions" class="page">
            <h2 style="color: var(--green); margin-bottom: 20px">
              Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© â“
            </h2>

            <div class="section-card">
              <div class="section-title" id="qFormTitle">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</div>
              <div class="form-row">
                <div class="form-group" style="margin: 0">
                  <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                  <select id="qType" onchange="onQuestionTypeChange()">
                    <option value="multiple_choice">ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                    <option value="true_false">âœ… ØµØ­ Ø£Ùˆ Ø®Ø·Ø£</option>
                    <option value="fill_blank">âœï¸ Ø£ÙƒÙ…Ù„ Ø§Ù„ÙØ±Ø§Øº</option>
                  </select>
                </div>
                <div class="form-group" style="margin: 0">
                  <label>Ø§Ù„ÙŠÙˆÙ…</label>
                  <select id="qDay"></select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group" style="margin: 0">
                  <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                  <select id="qCat">
                    <option value="quran">ğŸ“– Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…</option>
                    <option value="ramadan">ğŸŒ™ Ø±Ù…Ø¶Ø§Ù†</option>
                    <option value="general">Ø¹Ø§Ù…</option>
                  </select>
                </div>
                <div class="form-group" style="margin: 0">
                  <label>Ø§Ù„ØªØ±ØªÙŠØ¨</label>
                  <input type="number" id="qOrder" value="1" min="1" max="10" />
                </div>
              </div>
              <div class="form-group">
                <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                <textarea
                  id="qText"
                  placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..."
                ></textarea>
              </div>

              <!-- MCQ Options (dynamic) -->
              <div id="mcqSection">
                <label
                  >Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                  <span style="color: var(--muted); font-weight: 400"
                    >(Ø­Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©)</span
                  ></label
                >
                <div id="optionsContainer"></div>
                <button
                  class="btn btn-outline btn-sm"
                  onclick="addOptionField()"
                  style="margin-top: 8px"
                  id="addOptBtn"
                >
                  â• Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±
                </button>
              </div>

              <!-- True/False Section -->
              <div id="tfSection" style="display: none">
                <div class="form-group">
                  <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                  <select id="tfCorrect">
                    <option value="0">âœ… ØµØ­</option>
                    <option value="1">âŒ Ø®Ø·Ø£</option>
                  </select>
                </div>
              </div>

              <!-- Fill Blank Section -->
              <div id="fbSection" style="display: none">
                <div class="form-group">
                  <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                  <input
                    type="text"
                    id="fbCorrect"
                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡Ù†Ø§..."
                  />
                </div>
              </div>

              <div style="display: flex; gap: 10px; margin-top: 12px">
                <button
                  class="btn btn-gold"
                  onclick="addQuestion()"
                  id="qSubmitBtn"
                >
                  â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„
                </button>
                <button
                  class="btn btn-outline"
                  onclick="resetQuestionForm()"
                  id="qCancelEditBtn"
                  style="display: none"
                >
                  Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
              </div>
            </div>

            <div class="section-card">
              <div class="section-title">Ø¹Ø±Ø¶ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙŠÙˆÙ…</div>
              <div class="day-tabs" id="dayTabsQ"></div>
              <div id="questionsList"></div>
            </div>
          </div>

          <!-- Leaderboard -->
          <div id="page-leaderboard" class="page">
            <h2 style="color: var(--green); margin-bottom: 20px">
              Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†
            </h2>
            <div class="table-wrap">
              <div class="table-header">
                <h3>ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3>
                <button class="btn btn-blue btn-sm" onclick="loadLeaderboard()">
                  ğŸ”„ ØªØ­Ø¯ÙŠØ«
                </button>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    <th>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                  </tr>
                </thead>
                <tbody id="leaderTable"></tbody>
              </table>
            </div>
          </div>

          <!-- Participants -->
          <div id="page-participants" class="page">
            <h2 style="color: var(--green); margin-bottom: 20px">
              Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ğŸ‘¥
            </h2>
            <div class="table-wrap">
              <div class="table-header">
                <h3 id="participantsCount">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</h3>
                <button
                  class="btn btn-blue btn-sm"
                  onclick="loadParticipants()"
                >
                  ğŸ”„ ØªØ­Ø¯ÙŠØ«
                </button>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                  </tr>
                </thead>
                <tbody id="participantsTable"></tbody>
              </table>
            </div>
          </div>

          <!-- Settings -->
          <div id="page-settings" class="page">
            <h2 style="color: var(--green); margin-bottom: 20px">
              Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸
            </h2>
            <div class="section-card">
              <div class="section-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</div>
              <div class="settings-row">
                <div class="form-group">
                  <label>ÙˆÙ‚Øª ÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</label>
                  <input type="time" id="settOpenTime" value="21:00" />
                </div>
                <div class="form-group">
                  <label>ÙˆÙ‚Øª Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</label>
                  <input type="time" id="settCloseTime" value="22:45" />
                </div>
                <div class="form-group">
                  <label>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø±Ù…Ø¶Ø§Ù†</label>
                  <select id="settDay"></select>
                </div>
                <button
                  class="btn btn-gold"
                  onclick="saveSettings()"
                  style="flex-shrink: 0"
                >
                  Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
              </div>
            </div>

            <div class="section-card" style="margin-top: 20px">
              <div class="section-title">ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</div>
              <div
                class="settings-row"
                style="flex-direction: column; gap: 12px"
              >
                <div class="form-group" style="width: 100%">
                  <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</label>
                  <input
                    type="text"
                    id="pushTitle"
                    placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ø¢Ù†!"
                  />
                </div>
                <div class="form-group" style="width: 100%">
                  <label>Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</label>
                  <input
                    type="text"
                    id="pushBody"
                    placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø±Ø¹ Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·!"
                  />
                </div>
                <div style="display: flex; align-items: center; gap: 12px">
                  <button class="btn btn-gold" onclick="sendPushNotification()">
                    ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹
                  </button>
                  <span
                    id="pushResult"
                    style="font-size: 0.85rem; color: var(--muted)"
                  ></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API = "/api";
      let ADMIN_TOKEN = "";
      let selectedQDay = 1;
      let optionCount = 0;
      let editingQuestionId = null;

      // Populate day selects
      function populateDaySelects() {
        ["qDay", "settDay"].forEach((id) => {
          const el = document.getElementById(id);
          if (!el) return;
          el.innerHTML = "";
          for (let i = 1; i <= 30; i++) {
            el.innerHTML += `<option value="${i}">Ø§Ù„ÙŠÙˆÙ… ${i}</option>`;
          }
        });
      }
      populateDaySelects();

      function doLogin() {
        const pass = document.getElementById("adminPass").value;
        ADMIN_TOKEN = pass;
        fetch(`${API}/admin/stats`, { headers: { "X-Admin-Token": pass } })
          .then((r) => {
            if (r.ok) {
              document.getElementById("loginWrap").style.display = "none";
              document.getElementById("dashboard").style.display = "block";
              initDashboard();
            } else {
              document.getElementById("loginErr").style.display = "block";
            }
          })
          .catch(() => {
            document.getElementById("loginErr").style.display = "block";
          });
      }

      function adminHeaders() {
        return {
          "Content-Type": "application/json",
          "X-Admin-Token": ADMIN_TOKEN,
        };
      }

      function showPage(name) {
        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.remove("active"));
        document
          .querySelectorAll(".nav-item")
          .forEach((n) => n.classList.remove("active"));
        document.getElementById(`page-${name}`).classList.add("active");
        event.currentTarget.classList.add("active");

        if (name === "overview") loadStats();
        if (name === "leaderboard") loadLeaderboard();
        if (name === "participants") loadParticipants();
        if (name === "questions") initQuestionDays();
        if (name === "settings") loadCurrentSettings();
      }

      function initDashboard() {
        loadStats();
        initQuestionDays();
        resetQuestionForm();
      }

      // --- Question Type UI ---
      function onQuestionTypeChange() {
        const type = document.getElementById("qType").value;
        document.getElementById("mcqSection").style.display =
          type === "multiple_choice" ? "" : "none";
        document.getElementById("tfSection").style.display =
          type === "true_false" ? "" : "none";
        document.getElementById("fbSection").style.display =
          type === "fill_blank" ? "" : "none";
        if (type === "multiple_choice") {
          resetMCQOptions();
        }
      }

      function resetMCQOptions() {
        const container = document.getElementById("optionsContainer");
        container.innerHTML = "";
        optionCount = 0;
        // Start with 2 options
        addOptionField();
        addOptionField();
      }

      function addOptionField(value = "") {
        const container = document.getElementById("optionsContainer");
        const count = container.querySelectorAll(".option-entry").length;
        if (count >= 6) {
          alert("Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 6 Ø®ÙŠØ§Ø±Ø§Øª");
          return;
        }

        const idx = optionCount++;
        const div = document.createElement("div");
        div.className = "option-entry";
        div.innerHTML = `
    <input type="radio" name="correctOpt" value="${idx}" class="opt-radio" ${
          count === 0 ? "checked" : ""
        } />
    <input type="text" class="opt-input" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± ${
      count + 1
    }" value="${value}" />
    <button class="remove-opt" onclick="removeOptionField(this)" title="Ø­Ø°Ù">âœ•</button>
  `;
        container.appendChild(div);
        updateAddButton();
      }

      function removeOptionField(btn) {
        const container = document.getElementById("optionsContainer");
        const entries = container.querySelectorAll(".option-entry");
        if (entries.length <= 2) {
          alert("ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
          return;
        }

        const entry = btn.closest(".option-entry");
        const wasChecked = entry.querySelector(".opt-radio").checked;
        entry.remove();

        // Reindex radios and check first if removed was checked
        const remaining = container.querySelectorAll(".option-entry");
        remaining.forEach((el, i) => {
          el.querySelector(".opt-radio").value = i;
          el.querySelector(".opt-input").placeholder = `Ø§Ù„Ø®ÙŠØ§Ø± ${i + 1}`;
        });
        if (wasChecked && remaining.length > 0) {
          remaining[0].querySelector(".opt-radio").checked = true;
        }
        updateAddButton();
      }

      function updateAddButton() {
        const count = document
          .getElementById("optionsContainer")
          .querySelectorAll(".option-entry").length;
        document.getElementById("addOptBtn").style.display =
          count >= 6 ? "none" : "";
      }

      function resetQuestionForm() {
        editingQuestionId = null;
        document.getElementById("qFormTitle").textContent = "Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯";
        document.getElementById("qSubmitBtn").textContent = "â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„";
        const cancelBtn = document.getElementById("qCancelEditBtn");
        if (cancelBtn) cancelBtn.style.display = "none";
        document.getElementById("qType").value = "multiple_choice";
        document.getElementById("qText").value = "";
        document.getElementById("qOrder").value = "1";
        document.getElementById("fbCorrect").value = "";
        document.getElementById("tfCorrect").value = "0";
        onQuestionTypeChange();
      }

      // --- Stats ---
      async function loadStats() {
        const r = await fetch(`${API}/admin/stats`, {
          headers: adminHeaders(),
        });
        const d = await r.json();
        document.getElementById("st-participants").textContent =
          d.total_participants;
        document.getElementById("st-today").textContent = d.today_participants;
        document.getElementById("st-answers").textContent = d.total_answers;
        document.getElementById("st-accuracy").textContent =
          d.accuracy_rate + "%";

        const lb = await fetch(`${API}/admin/leaderboard`, {
          headers: adminHeaders(),
        });
        const data = await lb.json();
        const top10 = data.slice(0, 10);
        document.getElementById("topTable").innerHTML =
          top10
            .map(
              (p, i) => `
    <tr>
      <td><span class="rank-badge rank-${i < 3 ? i + 1 : "other"}">${
                i + 1
              }</span></td>
      <td>${p.name}</td>
      <td><span class="points-badge">${p.points || 0} Ù†Ù‚Ø·Ø©</span></td>
      <td style="color:var(--muted);font-size:0.8rem">${
        p.created_at?.split("T")[0] || "-"
      }</td>
    </tr>
  `
            )
            .join("") ||
          '<tr><td colspan="4" style="text-align:center;color:var(--muted);padding:30px">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¨Ø¹Ø¯</td></tr>';
      }

      async function loadLeaderboard() {
        const r = await fetch(`${API}/admin/leaderboard`, {
          headers: adminHeaders(),
        });
        const data = await r.json();
        document.getElementById("leaderTable").innerHTML =
          data
            .map(
              (p, i) => `
    <tr>
      <td><span class="rank-badge rank-${i < 3 ? i + 1 : "other"}">${
                i + 1
              }</span></td>
      <td>${p.name}</td>
      <td style="direction:ltr;text-align:left">${p.phone || "-"}</td>
      <td><span class="points-badge">${p.points || 0} Ù†Ù‚Ø·Ø©</span></td>
      <td style="color:var(--muted)">${p.total_answered || 0} / ${
                p.total_answered || 0
              }</td>
      <td style="color:var(--muted);font-size:0.8rem">${
        p.created_at?.split("T")[0] || "-"
      }</td>
    </tr>
  `
            )
            .join("") ||
          '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:30px">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }

      async function loadParticipants() {
        const r = await fetch(`${API}/admin/participants`, {
          headers: adminHeaders(),
        });
        const data = await r.json();
        document.getElementById(
          "participantsCount"
        ).textContent = `Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† (${data.length})`;
        document.getElementById("participantsTable").innerHTML =
          data
            .map(
              (p) => `
    <tr>
      <td>${p.name}</td>
      <td style="direction:ltr;text-align:left">${p.phone || "-"}</td>
      <td style="color:var(--muted);font-size:0.8rem">${
        p.created_at?.split("T")[0] || "-"
      }</td>
    </tr>
  `
            )
            .join("") ||
          '<tr><td colspan="3" style="text-align:center;color:var(--muted);padding:30px">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</td></tr>';
      }

      // --- Questions ---
      function initQuestionDays() {
        const container = document.getElementById("dayTabsQ");
        container.innerHTML = "";
        for (let i = 1; i <= 30; i++) {
          const tab = document.createElement("div");
          tab.className = "day-tab" + (i === selectedQDay ? " active" : "");
          tab.textContent = i;
          tab.onclick = () => {
            selectedQDay = i;
            initQuestionDays();
            loadDayQuestions(i);
          };
          container.appendChild(tab);
        }
        loadDayQuestions(selectedQDay);
      }

      async function loadDayQuestions(day) {
        const r = await fetch(`${API}/admin/questions/${day}`, {
          headers: adminHeaders(),
        });
        const data = await r.json();
        const container = document.getElementById("questionsList");
        if (!data.length) {
          container.innerHTML =
            '<div class="empty-state"><div class="icon">ğŸ“</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p></div>';
          return;
        }
        const catMap = {
          quran: "cat-quran",
          ramadan: "cat-ramadan",
          general: "cat-general",
        };
        const catLabel = {
          quran: "ğŸ“– Ù‚Ø±Ø¢Ù†",
          ramadan: "ğŸŒ™ Ø±Ù…Ø¶Ø§Ù†",
          general: "Ø¹Ø§Ù…",
        };
        const typeMap = {
          multiple_choice: { cls: "type-mcq", label: "ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯" },
          true_false: { cls: "type-tf", label: "âœ… ØµØ­/Ø®Ø·Ø£" },
          fill_blank: { cls: "type-fb", label: "âœï¸ Ø£ÙƒÙ…Ù„ Ø§Ù„ÙØ±Ø§Øº" },
        };

        container.innerHTML = data
          .map((q) => {
            const typeInfo =
              typeMap[q.question_type] || typeMap.multiple_choice;
            let optionsHtml = "";

            if (q.question_type === "fill_blank") {
              optionsHtml = `
        <div style="padding:8px 12px;background:rgba(46,204,113,0.15);border-radius:8px;border:1px solid rgba(46,204,113,0.3)">
          <strong style="color:var(--green)">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong> ${q.correct_answer}
        </div>`;
            } else {
              const opts = q.options || [];
              const cols =
                opts.length <= 2
                  ? "1fr 1fr"
                  : opts.length === 3
                  ? "1fr 1fr 1fr"
                  : "1fr 1fr";
              optionsHtml = `<div style="display:grid;grid-template-columns:${cols};gap:8px;font-size:0.85rem">
        ${opts
          .map(
            (opt, i) => `
          <div style="padding:8px 12px;background:${
            String(q.correct_answer) === String(i)
              ? "rgba(46,204,113,0.15)"
              : "rgba(255,255,255,0.03)"
          };border-radius:8px;border:1px solid ${
              String(q.correct_answer) === String(i)
                ? "rgba(46,204,113,0.3)"
                : "rgba(255,255,255,0.05)"
            }">
            <strong style="color:${
              String(q.correct_answer) === String(i)
                ? "var(--green)"
                : "var(--muted)"
            }">${i + 1}</strong> ${opt}
            ${
              String(q.correct_answer) === String(i)
                ? '<span style="color:var(--green)"> âœ“</span>'
                : ""
            }
          </div>`
          )
          .join("")}
      </div>`;
            }

            return `
      <div style="background:var(--card2);border-radius:12px;padding:16px;margin-bottom:12px;border:1px solid rgba(201,168,76,0.1)">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
          <div>
            <span class="type-badge ${typeInfo.cls}">${typeInfo.label}</span>
            <span class="correct-badge ${
              catMap[q.category] || "cat-general"
            }">${catLabel[q.category] || "ï¸ Ø¹Ø§Ù…"}</span>
          </div>
          <div style="display:flex;gap:6px">
            <button class="btn btn-blue btn-sm" onclick='editQuestion(${JSON.stringify(
              q
            ).replace(/'/g, "&#39;")})'>âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn btn-danger btn-sm" onclick="deleteQuestion(${
              q.id
            })">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          </div>
        </div>
        <p style="margin-bottom:12px;font-size:0.95rem;line-height:1.7">${
          q.question_text
        }</p>
        ${optionsHtml}
      </div>`;
          })
          .join("");
      }

      function editQuestion(q) {
        editingQuestionId = q.id;
        document.getElementById("qFormTitle").textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„";
        document.getElementById("qSubmitBtn").textContent = "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
        document.getElementById("qCancelEditBtn").style.display = "";

        document.getElementById("qType").value = q.question_type;
        document.getElementById("qDay").value = q.day;
        document.getElementById("qCat").value = q.category || "general";
        document.getElementById("qOrder").value = q.order_num || 1;
        document.getElementById("qText").value = q.question_text;

        onQuestionTypeChange();

        if (q.question_type === "multiple_choice") {
          const container = document.getElementById("optionsContainer");
          container.innerHTML = "";
          optionCount = 0;
          (q.options || []).forEach((opt, i) => {
            addOptionField(opt);
          });
          // Check the correct answer radio
          const correctIdx = parseInt(q.correct_answer);
          const radios = container.querySelectorAll(".opt-radio");
          if (radios[correctIdx]) radios[correctIdx].checked = true;
        } else if (q.question_type === "true_false") {
          document.getElementById("tfCorrect").value = q.correct_answer;
        } else if (q.question_type === "fill_blank") {
          document.getElementById("fbCorrect").value = q.correct_answer;
        }

        // Scroll to form
        document
          .getElementById("qFormTitle")
          .scrollIntoView({ behavior: "smooth" });
      }

      async function addQuestion() {
        const type = document.getElementById("qType").value;
        const questionText = document.getElementById("qText").value.trim();

        if (!questionText) {
          alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„");
          return;
        }

        let options = [];
        let correctAnswer = "";

        if (type === "multiple_choice") {
          const inputs = document.querySelectorAll(
            "#optionsContainer .opt-input"
          );
          const radios = document.querySelectorAll(
            "#optionsContainer .opt-radio"
          );
          options = [...inputs].map((el) => el.value.trim());

          if (options.some((o) => !o)) {
            alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª");
            return;
          }
          if (options.length < 2) {
            alert("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
            return;
          }

          const checked = [...radios].find((r) => r.checked);
          if (!checked) {
            alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©");
            return;
          }

          // Find the index of the checked radio among current entries
          const entries = [
            ...document.querySelectorAll("#optionsContainer .option-entry"),
          ];
          const checkedEntry = checked.closest(".option-entry");
          correctAnswer = String(entries.indexOf(checkedEntry));
        } else if (type === "true_false") {
          options = ["ØµØ­", "Ø®Ø·Ø£"];
          correctAnswer = document.getElementById("tfCorrect").value;
        } else if (type === "fill_blank") {
          correctAnswer = document.getElementById("fbCorrect").value.trim();
          if (!correctAnswer) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©");
            return;
          }
        }

        const data = {
          day: parseInt(document.getElementById("qDay").value),
          question_type: type,
          question_text: questionText,
          options: options,
          correct_answer: correctAnswer,
          category: document.getElementById("qCat").value,
          order_num: parseInt(document.getElementById("qOrder").value),
        };

        let r;
        if (editingQuestionId) {
          r = await fetch(`${API}/admin/questions/${editingQuestionId}`, {
            method: "PUT",
            headers: adminHeaders(),
            body: JSON.stringify(data),
          });
        } else {
          r = await fetch(`${API}/admin/questions`, {
            method: "POST",
            headers: adminHeaders(),
            body: JSON.stringify(data),
          });
        }
        if (r.ok) {
          const wasEditing = !!editingQuestionId;
          resetQuestionForm();
          selectedQDay = data.day;
          initQuestionDays();
          alert(
            wasEditing ? "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­" : "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­"
          );
        } else {
          const err = await r.json().catch(() => ({}));
          alert(err.detail || "Ø­Ø¯Ø« Ø®Ø·Ø£!");
        }
      }

      async function deleteQuestion(id) {
        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ")) return;
        const r = await fetch(`${API}/admin/questions/${id}`, {
          method: "DELETE",
          headers: adminHeaders(),
        });
        if (r.ok) loadDayQuestions(selectedQDay);
      }

      async function loadCurrentSettings() {
        try {
          const r = await fetch(`${API}/status`);
          const data = await r.json();
          if (data.quiz_open_time)
            document.getElementById("settOpenTime").value = data.quiz_open_time;
          if (data.quiz_close_time)
            document.getElementById("settCloseTime").value =
              data.quiz_close_time;
          if (data.current_day)
            document.getElementById("settDay").value = data.current_day;
        } catch (e) {}
      }

      async function sendPushNotification() {
        const title = document.getElementById("pushTitle").value.trim();
        const body = document.getElementById("pushBody").value.trim();
        const result = document.getElementById("pushResult");
        if (!title || !body) {
          result.style.color = "var(--red)";
          result.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Øµ";
          return;
        }
        result.style.color = "var(--muted)";
        result.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
        try {
          const r = await fetch(`${API}/admin/push/send`, {
            method: "POST",
            headers: adminHeaders(),
            body: JSON.stringify({ title, body }),
          });
          if (!r.ok) throw new Error();
          const data = await r.json();
          result.style.color = "var(--green)";
          result.textContent = `âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ${data.sent} Ù…Ø´ØªØ±Ùƒ${
            data.removed ? ` (ØªÙ… Ø­Ø°Ù ${data.removed} Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ)` : ""
          }`;
        } catch (e) {
          result.style.color = "var(--red)";
          result.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
        }
      }

      async function saveSettings() {
        const data = {
          quiz_open_time: document.getElementById("settOpenTime").value,
          quiz_close_time: document.getElementById("settCloseTime").value,
          current_day: parseInt(document.getElementById("settDay").value),
        };
        const r = await fetch(`${API}/admin/settings`, {
          method: "PUT",
          headers: adminHeaders(),
          body: JSON.stringify(data),
        });
        if (r.ok) alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª");
      }

      async function exportData() {
        const r = await fetch(`${API}/admin/export`, {
          headers: adminHeaders(),
        });
        const data = await r.json();
        if (!data.length) {
          alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");
          return;
        }

        const headers = Object.keys(data[0]);
        const csv = [
          headers.join(","),
          ...data.map((row) =>
            headers.map((h) => `"${row[h] || ""}"`).join(",")
          ),
        ].join("\n");
        const blob = new Blob(["\uFEFF" + csv], {
          type: "text/csv;charset=utf-8",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `ramadan_quiz_${
          new Date().toISOString().split("T")[0]
        }.csv`;
        a.click();
        URL.revokeObjectURL(url);
      }
    </script>
  </body>
</html>
