<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© ØµÙ†Ø¯ÙˆÙ‚ ( Ø¨Ø°Ù„ ) Ø§Ù„ÙˆÙ‡ÙŠØ¯ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ© ğŸŒ™</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --gold: #c9a84c;
        --gold-light: #f0d080;
        --gold-dark: #8b6914;
        --deep: #0a0f1e;
        --deep2: #111827;
        --card: #161d2f;
        --card2: #1e2740;
        --green: #2ecc71;
        --red: #e74c3c;
        --text: #f0e6d3;
        --muted: #8892a4;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Cairo", sans-serif;
        background: var(--deep);
        color: var(--text);
        min-height: 100vh;
        overflow-x: hidden;
      }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(
            1px 1px at 10% 15%,
            rgba(255, 255, 255, 0.8) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 30% 25%,
            rgba(255, 255, 255, 0.6) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 55% 10%,
            rgba(255, 255, 255, 0.9) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 75% 20%,
            rgba(255, 255, 255, 0.7) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 90% 8%,
            rgba(255, 255, 255, 0.8) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 20% 45%,
            rgba(255, 255, 255, 0.5) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 45% 55%,
            rgba(255, 255, 255, 0.7) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 65% 40%,
            rgba(255, 255, 255, 0.6) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 85% 50%,
            rgba(255, 255, 255, 0.8) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 5% 70%,
            rgba(255, 255, 255, 0.6) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 35% 80%,
            rgba(255, 255, 255, 0.7) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 60% 75%,
            rgba(255, 255, 255, 0.5) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 80% 85%,
            rgba(255, 255, 255, 0.8) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 15% 90%,
            rgba(255, 255, 255, 0.6) 0%,
            transparent 100%
          ),
          radial-gradient(
            1px 1px at 50% 95%,
            rgba(255, 255, 255, 0.7) 0%,
            transparent 100%
          );
        pointer-events: none;
        z-index: 0;
      }
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          ellipse at 50% 0%,
          rgba(201, 168, 76, 0.08) 0%,
          transparent 60%
        );
        pointer-events: none;
        z-index: 0;
      }
      .container {
        position: relative;
        z-index: 1;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px 16px;
      }
      .header {
        text-align: center;
        padding: 30px 0 20px;
        animation: fadeDown 0.8s ease;
      }
      .header .moon {
        font-size: 3.5rem;
        line-height: 1;
        margin-bottom: 8px;
        animation: moonFloat 3s ease-in-out infinite;
      }
      @keyframes moonFloat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }
      .header h1 {
        font-size: 2.2rem;
        color: var(--gold);
        text-shadow: 0 0 30px rgba(201, 168, 76, 0.4);
        margin-bottom: 4px;
      }
      .day-badge {
        display: inline-block;
        margin-top: 12px;
        padding: 6px 20px;
        background: linear-gradient(135deg, var(--gold-dark), var(--gold));
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 700;
        color: var(--deep);
        letter-spacing: 0.5px;
      }
      .welcome-name {
        color: var(--muted);
        font-size: 0.85rem;
        margin-top: 8px;
      }
      .card {
        background: var(--card);
        border: 1px solid rgba(201, 168, 76, 0.15);
        border-radius: 20px;
        padding: 28px 24px;
        margin-bottom: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        animation: fadeUp 0.6s ease;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .countdown-label {
        color: var(--muted);
        font-size: 0.85rem;
        margin-bottom: 16px;
        text-align: center;
      }
      .countdown-boxes {
        display: flex;
        justify-content: center;
        gap: 12px;
      }
      .cd-box {
        background: var(--card2);
        border: 1px solid rgba(201, 168, 76, 0.2);
        border-radius: 12px;
        padding: 16px 20px;
        min-width: 72px;
        text-align: center;
      }
      .cd-box .num {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--gold);
        line-height: 1;
        display: block;
      }
      .cd-box .lbl {
        font-size: 0.7rem;
        color: var(--muted);
        margin-top: 4px;
        display: block;
      }
      .quiz-open-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px;
        background: rgba(46, 204, 113, 0.1);
        border: 1px solid rgba(46, 204, 113, 0.3);
        border-radius: 12px;
        color: var(--green);
        font-weight: 600;
        font-size: 0.95rem;
      }
      .pulse-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--green);
        animation: pulse 1.5s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.3);
        }
      }
      .auth-tabs {
        display: flex;
        margin-bottom: 20px;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid rgba(201, 168, 76, 0.2);
      }
      .auth-tab {
        flex: 1;
        padding: 12px;
        text-align: center;
        cursor: pointer;
        font-weight: 700;
        font-size: 0.9rem;
        transition: all 0.2s;
        background: var(--card2);
        color: var(--muted);
        border: none;
        font-family: "Cairo", sans-serif;
      }
      .auth-tab.active {
        background: linear-gradient(
          135deg,
          rgba(201, 168, 76, 0.2),
          rgba(201, 168, 76, 0.1)
        );
        color: var(--gold);
        border-bottom: 2px solid var(--gold);
      }
      .auth-panel {
        display: none;
      }
      .auth-panel.active {
        display: block;
      }
      .menu-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .menu-box {
        background: var(--card2);
        border: 1px solid rgba(201, 168, 76, 0.15);
        border-radius: 16px;
        padding: 24px 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
      }
      .menu-box:hover {
        border-color: var(--gold);
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(201, 168, 76, 0.15);
      }
      .menu-box .menu-icon {
        font-size: 2rem;
        margin-bottom: 8px;
      }
      .menu-box .menu-label {
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--text);
      }
      .menu-box .menu-desc {
        font-size: 0.7rem;
        color: var(--muted);
        margin-top: 4px;
      }
      .menu-box.highlight {
        border-color: rgba(46, 204, 113, 0.4);
        background: linear-gradient(
          135deg,
          rgba(46, 204, 113, 0.08),
          var(--card2)
        );
      }
      .lb-title {
        text-align: center;
        color: var(--gold);
        font-size: 1rem;
        margin-bottom: 12px;
      }
      .lb-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .lb-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--card2);
        border-radius: 10px;
        padding: 10px 14px;
        border: 1px solid rgba(201, 168, 76, 0.1);
      }
      .lb-row.top-3 {
        border-color: rgba(201, 168, 76, 0.3);
        background: linear-gradient(
          135deg,
          rgba(201, 168, 76, 0.08),
          rgba(201, 168, 76, 0.02)
        );
      }
      .lb-rank {
        font-weight: 900;
        font-size: 1.1rem;
        color: var(--gold);
        min-width: 32px;
        text-align: center;
      }
      .lb-points {
        font-weight: 700;
        color: var(--text);
        font-size: 0.95rem;
      }
      .lb-points span {
        font-size: 0.75rem;
        color: var(--muted);
        font-weight: 400;
      }
      .back-btn {
        background: none;
        border: 1px solid rgba(201, 168, 76, 0.2);
        color: var(--gold);
        padding: 8px 16px;
        border-radius: 10px;
        cursor: pointer;
        font-family: "Cairo", sans-serif;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 16px;
        transition: all 0.2s;
      }
      .back-btn:hover {
        background: rgba(201, 168, 76, 0.1);
      }
      .back-btn.active-day {
        background: rgba(201, 168, 76, 0.15);
        border-color: var(--gold);
      }
      .history-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--card2);
        border-radius: 10px;
        padding: 12px 14px;
        border: 1px solid rgba(201, 168, 76, 0.1);
        margin-bottom: 8px;
      }
      .history-row .day-label {
        font-weight: 700;
        color: var(--gold);
      }
      .history-row .day-info {
        font-size: 0.8rem;
        color: var(--muted);
      }
      .history-row .day-action {
        font-size: 0.8rem;
        color: var(--gold);
        cursor: pointer;
        text-decoration: underline;
      }
      .prev-answer-card {
        background: var(--card2);
        border-radius: 12px;
        padding: 14px;
        border: 1px solid rgba(201, 168, 76, 0.1);
        margin-bottom: 10px;
      }
      .prev-answer-card .pa-q {
        font-weight: 700;
        margin-bottom: 6px;
        font-size: 0.9rem;
      }
      .prev-answer-card .pa-a {
        color: var(--muted);
        font-size: 0.85rem;
      }
      .logout-btn {
        background: rgba(231, 76, 60, 0.12);
        border: 1px solid rgba(231, 76, 60, 0.4);
        color: #ff6b6b;
        cursor: pointer;
        font-family: "Cairo", sans-serif;
        font-size: 0.85rem;
        font-weight: 600;
        padding: 10px 24px;
        border-radius: 10px;
        margin-top: 12px;
        transition: all 0.2s;
      }
      .logout-btn:hover {
        background: rgba(231, 76, 60, 0.2);
      }
      /* Answer Summary */
      .summary-card {
        background: var(--card2);
        padding: 14px 16px;
        margin-bottom: 10px;
        border-right: 4px solid var(--muted);
      }
      .summary-card.correct {
        border-right-color: var(--green);
      }
      .summary-card.wrong {
        border-right-color: var(--red);
      }
      .summary-q {
        font-weight: 700;
        font-size: 0.9rem;
        margin-bottom: 8px;
      }
      .summary-row {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.82rem;
        margin-bottom: 4px;
      }
      .summary-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 700;
      }
      .summary-badge.correct {
        background: rgba(46, 204, 113, 0.15);
        color: var(--green);
      }
      .summary-badge.wrong {
        background: rgba(231, 76, 60, 0.15);
        color: var(--red);
      }
      .summary-your {
        color: var(--muted);
      }
      .summary-correct-ans {
        color: var(--gold);
      }
      .summary-stats {
        display: flex;
        justify-content: center;
        gap: 24px;
        margin: 16px 0;
      }
      .summary-stat {
        text-align: center;
      }
      .summary-stat .num {
        font-size: 1.6rem;
        font-weight: 900;
        display: block;
      }
      .summary-stat .lbl {
        font-size: 0.75rem;
        color: var(--muted);
      }
      .summary-stat .num.green {
        color: var(--green);
      }
      .summary-stat .num.red {
        color: var(--red);
      }
      /* Skeleton Loading */
      .skeleton {
        background: linear-gradient(
          90deg,
          var(--card2) 25%,
          rgba(201, 168, 76, 0.08) 50%,
          var(--card2) 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 8px;
      }
      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
      .skel-line {
        height: 16px;
        margin-bottom: 8px;
        border-radius: 6px;
      }
      .skel-line.w60 {
        width: 60%;
        margin-inline: auto;
      }
      .skel-line.w40 {
        width: 40%;
        margin-inline: auto;
      }
      .skel-line.w80 {
        width: 80%;
        margin-inline: auto;
      }
      .skel-box {
        height: 48px;
        border-radius: 10px;
      }
      .skel-circle {
        width: 48px;
        height: 48px;
        border-radius: 50%;
      }
      .skel-countdown {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 12px;
      }
      .skel-countdown .skel-cd-item {
        width: 70px;
        height: 64px;
        border-radius: 12px;
      }
      .skel-lb-row {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 0;
      }
      .skel-lb-row .skel-rank {
        width: 32px;
        height: 32px;
        border-radius: 50%;
      }
      .skel-lb-row .skel-bar {
        flex: 1;
        height: 18px;
        border-radius: 6px;
      }
      .skel-lb-row .skel-pts {
        width: 40px;
        height: 18px;
        border-radius: 6px;
      }
      /* Popup Modal */
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.2s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .popup-box {
        background: var(--card);
        border: 1px solid rgba(201, 168, 76, 0.2);
        border-radius: 20px;
        padding: 32px 28px;
        max-width: 360px;
        width: 90%;
        text-align: center;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
        animation: popIn 0.25s ease;
      }
      @keyframes popIn {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .popup-icon {
        font-size: 3rem;
        margin-bottom: 12px;
      }
      .popup-title {
        color: var(--gold);
        font-size: 1.15rem;
        font-weight: 700;
        margin-bottom: 8px;
      }
      .popup-msg {
        color: var(--muted);
        font-size: 0.9rem;
        line-height: 1.7;
        margin-bottom: 20px;
      }
      .popup-btn {
        background: linear-gradient(135deg, #c9a84c, #f0d080);
        color: var(--deep);
        border: none;
        border-radius: 12px;
        padding: 12px 32px;
        font-family: "Cairo", sans-serif;
        font-size: 0.95rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
      }
      .popup-btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }
      .form-group {
        margin-bottom: 18px;
      }
      label {
        display: block;
        font-size: 0.85rem;
        color: var(--muted);
        margin-bottom: 8px;
        font-weight: 600;
      }
      input[type="text"],
      input[type="tel"],
      input[type="password"] {
        width: 100%;
        padding: 14px 16px;
        background: var(--card2);
        border: 1px solid rgba(201, 168, 76, 0.2);
        border-radius: 12px;
        color: var(--text);
        font-family: "Cairo", sans-serif;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.2s;
        text-align: right;
        direction: rtl;
      }
      input:focus {
        border-color: var(--gold);
        box-shadow: 0 0 0 3px rgba(201, 168, 76, 0.1);
      }
      .hint {
        font-size: 0.75rem;
        color: var(--muted);
        margin-top: 5px;
      }
      .btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 14px;
        font-family: "Cairo", sans-serif;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
      }
      .btn-primary {
        background: linear-gradient(135deg, #c9a84c, #f0d080, #c9a84c);
        background-size: 200% 100%;
        color: var(--deep);
        box-shadow: 0 4px 20px rgba(201, 168, 76, 0.3);
      }
      .btn-primary:hover {
        background-position: right center;
        box-shadow: 0 6px 24px rgba(201, 168, 76, 0.5);
        transform: translateY(-1px);
      }
      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .question-progress {
        font-size: 0.8rem;
        color: var(--muted);
        background: var(--card2);
        padding: 5px 12px;
        border-radius: 20px;
      }
      .question-category {
        font-size: 0.75rem;
        color: var(--gold-dark);
        background: rgba(201, 168, 76, 0.1);
        border: 1px solid rgba(201, 168, 76, 0.2);
        padding: 4px 12px;
        border-radius: 20px;
      }
      .timer-wrap {
        margin-bottom: 20px;
      }
      .timer-bar-bg {
        height: 6px;
        background: var(--card2);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 6px;
      }
      .timer-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--gold), var(--gold-light));
        border-radius: 3px;
        transition: width 1s linear;
      }
      .timer-bar.warning {
        background: linear-gradient(90deg, #f39c12, #f1c40f);
      }
      .timer-bar.danger {
        background: linear-gradient(90deg, var(--red), #ff6b6b);
      }
      .timer-num {
        text-align: center;
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--gold);
      }
      .timer-num.warning {
        color: #f39c12;
      }
      .timer-num.danger {
        color: var(--red);
      }
      .question-text {
        font-family: "Amiri", serif;
        font-size: 1.25rem;
        line-height: 1.8;
        color: var(--text);
        margin-bottom: 24px;
        text-align: center;
        padding: 16px;
        background: var(--card2);
        border-radius: 12px;
        border-right: 3px solid var(--gold);
      }
      .fill-blank-input {
        width: 100%;
        padding: 14px 18px;
        background: var(--card2);
        border: 1.5px solid rgba(201, 168, 76, 0.3);
        border-radius: 12px;
        color: var(--text);
        font-family: "Cairo", sans-serif;
        font-size: 1rem;
        outline: none;
        text-align: center;
        direction: rtl;
        transition: border-color 0.2s;
        margin-bottom: 12px;
      }
      .fill-blank-input:focus {
        border-color: var(--gold);
        box-shadow: 0 0 0 3px rgba(201, 168, 76, 0.15);
      }
      .fill-blank-input:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .fill-blank-submit {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 12px;
        background: linear-gradient(135deg, #c9a84c, #f0d080);
        color: var(--deep);
        font-family: "Cairo", sans-serif;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
      }
      .fill-blank-submit:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }
      .fill-blank-submit:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      .options {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .option {
        padding: 14px 18px;
        background: var(--card2);
        border: 1.5px solid rgba(201, 168, 76, 0.15);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.95rem;
        text-align: right;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .option:hover {
        border-color: var(--gold);
        background: rgba(201, 168, 76, 0.05);
        transform: translateX(-2px);
      }
      .option.selected {
        border-color: var(--gold);
        background: rgba(201, 168, 76, 0.12);
      }
      .option.disabled {
        pointer-events: none;
      }
      .option-letter {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(201, 168, 76, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.85rem;
        color: var(--gold);
        flex-shrink: 0;
      }
      .option.selected .option-letter {
        background: var(--gold);
        color: var(--deep);
      }
      .answer-feedback {
        text-align: center;
        padding: 14px;
        border-radius: 12px;
        margin-top: 16px;
        font-weight: 600;
        font-size: 0.95rem;
        display: none;
      }
      .quiz-progress-bar {
        display: flex;
        gap: 4px;
        margin-bottom: 20px;
      }
      .qpb-item {
        flex: 1;
        height: 4px;
        border-radius: 2px;
        background: var(--card2);
        transition: background 0.3s;
      }
      .qpb-item.done-correct {
        background: var(--green);
      }
      .qpb-item.active {
        background: var(--gold);
      }
      .divider {
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(201, 168, 76, 0.3),
          transparent
        );
        margin: 20px 0;
      }
      .hidden {
        display: none !important;
      }
      .toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-60px);
        background: var(--card2);
        border: 1px solid rgba(201, 168, 76, 0.3);
        padding: 12px 24px;
        border-radius: 30px;
        font-size: 0.9rem;
        font-weight: 600;
        z-index: 1000;
        transition: transform 0.3s ease;
        white-space: nowrap;
      }
      .toast.show {
        transform: translateX(-50%) translateY(0);
      }
      .toast.error {
        border-color: rgba(231, 76, 60, 0.4);
        color: #ff8a80;
      }
      @media (max-width: 400px) {
        .header h1 {
          font-size: 1.8rem;
        }
        .cd-box {
          min-width: 58px;
          padding: 12px 14px;
        }
        .cd-box .num {
          font-size: 1.8rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="moon"><h1>Ù…Ø³Ø§Ø¨Ù‚Ø© ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø°Ù„ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</h1></div>
        <div class="day-badge" id="dayBadge">...</div>
        <div class="welcome-name hidden" id="welcomeName"></div>
      </div>

      <!-- AUTH SCREEN -->
      <div id="screenAuth" class="card hidden">
        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login')">
            ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          </button>
          <button class="auth-tab" onclick="switchAuthTab('signup')">
            ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
        <div id="panelLogin" class="auth-panel active">
          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label
            ><input type="tel" id="loginPhone" placeholder="05xxxxxxxx" />
          </div>
          <div class="form-group">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label
            ><input
              type="password"
              id="loginPassword"
              placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
            />
          </div>
          <button class="btn btn-primary" id="btnLogin" onclick="doLogin()">
            Ø¯Ø®ÙˆÙ„ ğŸš€
          </button>
        </div>
        <div id="panelSignup" class="auth-panel">
          <div class="form-group">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label
            ><input type="text" id="inputName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" />
          </div>
          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *</label
            ><input type="tel" id="inputPhone" placeholder="05xxxxxxxx" />
            <p class="hint">
              ğŸ“Œ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹ØŒ Ù„Ù† ÙŠÙØ´Ø§Ø±ÙÙƒ Ù…Ø¹ Ø£Ø­Ø¯
            </p>
          </div>
          <div class="form-group">
            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label
            ><input
              type="password"
              id="inputPassword"
              placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±"
            />
          </div>
          <button
            class="btn btn-primary"
            id="btnRegister"
            onclick="doRegister()"
          >
            Ø³Ø¬Ù‘Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€
          </button>
        </div>
      </div>

      <!-- DASHBOARD -->
      <div id="screenDashboard" class="hidden">
        <!-- Skeleton for countdown area -->
        <div id="skelCountdown" class="card">
          <div class="skeleton skel-line w60" style="margin-bottom: 14px"></div>
          <div class="skel-countdown">
            <div class="skeleton skel-cd-item"></div>
            <div class="skeleton skel-cd-item"></div>
            <div class="skeleton skel-cd-item"></div>
          </div>
        </div>
        <div id="dashCountdown" class="card hidden">
          <p class="countdown-label" id="countdownLabel">
            ØªÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ø§Ø¹Ø© Ù©:Ù Ù  Ù…Ø³Ø§Ø¡Ù‹
          </p>
          <div class="countdown-boxes">
            <div class="cd-box">
              <span class="num" id="cdSecs">00</span
              ><span class="lbl">Ø«Ø§Ù†ÙŠØ©</span>
            </div>
            <div class="cd-box">
              <span class="num" id="cdMins">00</span
              ><span class="lbl">Ø¯Ù‚ÙŠÙ‚Ø©</span>
            </div>
            <div class="cd-box">
              <span class="num" id="cdHours">00</span
              ><span class="lbl">Ø³Ø§Ø¹Ø©</span>
            </div>
          </div>
        </div>
        <div id="dashOpenBadge" class="card hidden">
          <div class="quiz-open-badge">
            <div class="pulse-dot"></div>
            <span>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†!</span>
          </div>
        </div>
        <div class="menu-grid">
          <div class="menu-box highlight" onclick="goToChallenge()">
            <div class="menu-icon">ğŸ¯</div>
            <div class="menu-label">ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="menu-desc">Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙŠÙˆÙ…</div>
          </div>
          <div class="menu-box" onclick="goToLeaderboard()">
            <div class="menu-icon">ğŸ†</div>
            <div class="menu-label">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</div>
            <div class="menu-desc">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</div>
          </div>
          <div class="menu-box" onclick="goToHistory()">
            <div class="menu-icon">ğŸ“Š</div>
            <div class="menu-label">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</div>
            <div class="menu-desc">Ø£ÙŠØ§Ù…Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</div>
          </div>
          <div class="menu-box" onclick="goToPrevAnswers()">
            <div class="menu-icon">ğŸ“</div>
            <div class="menu-label">Ø¥Ø¬Ø§Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</div>
            <div class="menu-desc">Ø±Ø§Ø¬Ø¹ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ</div>
          </div>
        </div>
        <div style="text-align: center; margin-top: 16px">
          <button class="logout-btn" onclick="doLogout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <!-- LEADERBOARD PAGE -->
      <div id="screenLeaderboard" class="hidden">
        <button class="back-btn" onclick="goBack()">â†’ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <div class="card">
          <h3 class="lb-title">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
          <div id="skelLeaderboard">
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
          </div>
          <div id="lbPageList" class="lb-list"></div>
          <p
            id="lbEmpty"
            class="hidden"
            style="text-align: center; color: var(--muted); padding: 20px 0"
          >
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯
          </p>
        </div>
      </div>

      <!-- HISTORY PAGE -->
      <div id="screenHistory" class="hidden">
        <button class="back-btn" onclick="goBack()">â†’ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <div class="card">
          <h3 class="lb-title">ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</h3>
          <div id="skelHistory">
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
            <div class="skel-lb-row">
              <div class="skeleton skel-rank"></div>
              <div class="skeleton skel-bar"></div>
              <div class="skeleton skel-pts"></div>
            </div>
          </div>
          <div id="historyList"></div>
          <p
            id="historyEmpty"
            class="hidden"
            style="text-align: center; color: var(--muted); padding: 20px 0"
          >
            Ù„Ù… ØªØ´Ø§Ø±Ùƒ ÙÙŠ Ø£ÙŠ ÙŠÙˆÙ… Ø¨Ø¹Ø¯
          </p>
        </div>
      </div>

      <!-- PREVIOUS ANSWERS PAGE -->
      <div id="screenPrevAnswers" class="hidden">
        <button class="back-btn" onclick="goBack()">â†’ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <div class="card">
          <h3 class="lb-title" id="prevAnswersTitle">ğŸ“ Ø¥Ø¬Ø§Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
          <div id="skelPrevAnswers">
            <div
              style="
                display: flex;
                gap: 6px;
                justify-content: center;
                margin-bottom: 16px;
              "
            >
              <div
                class="skeleton"
                style="width: 50px; height: 32px; border-radius: 8px"
              ></div>
              <div
                class="skeleton"
                style="width: 50px; height: 32px; border-radius: 8px"
              ></div>
              <div
                class="skeleton"
                style="width: 50px; height: 32px; border-radius: 8px"
              ></div>
            </div>
            <div class="skeleton skel-line w80"></div>
            <div class="skeleton skel-line w60"></div>
            <div class="skeleton skel-line w80"></div>
          </div>
          <div
            id="prevDaySelector"
            style="
              display: flex;
              flex-wrap: wrap;
              gap: 6px;
              margin-bottom: 16px;
              justify-content: center;
            "
          ></div>
          <div id="prevAnswersList"></div>
          <p
            id="prevAnswersEmpty"
            class="hidden"
            style="text-align: center; color: var(--muted); padding: 20px 0"
          >
            Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ
          </p>
        </div>
      </div>

      <!-- QUIZ SCREEN -->
      <div id="screenQuiz" class="hidden">
        <div class="card">
          <div class="quiz-progress-bar" id="quizProgressBar"></div>
          <div class="question-header">
            <span class="question-progress" id="questionProgress"
              >Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 3</span
            >
            <span class="question-category" id="questionCategory">Ø¹Ø§Ù…</span>
          </div>
          <div class="timer-wrap">
            <div class="timer-bar-bg">
              <div class="timer-bar" id="timerBar"></div>
            </div>
            <div class="timer-num" id="timerNum">30</div>
          </div>
          <div class="question-text" id="questionText">...</div>
          <div class="options" id="optionsContainer"></div>
          <div class="answer-feedback" id="answerFeedback"></div>
        </div>
      </div>

      <!-- SCORE SCREEN -->
      <div id="screenScore" class="hidden">
        <div class="card" style="text-align: center; padding: 30px 0">
          <div style="font-size: 3.5rem; margin-bottom: 16px">ğŸ‰</div>
          <h2
            style="color: var(--gold); margin-bottom: 12px; font-size: 1.4rem"
          >
            Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ø§Ù‹!
          </h2>
          <p
            style="
              color: var(--text);
              font-size: 1.05rem;
              line-height: 1.8;
              margin-bottom: 10px;
            "
          >
            ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­
          </p>
          <div class="summary-stats" id="summaryStats"></div>
        </div>
        <div class="card" id="summaryContainer" style="margin-top: 12px">
          <h3
            style="
              color: var(--gold);
              font-size: 1rem;
              margin-bottom: 14px;
              text-align: center;
            "
          >
            ğŸ“‹ Ù…Ù„Ø®Øµ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ
          </h3>
          <div id="summaryList"></div>
        </div>
        <div class="card" style="margin-top: 12px; text-align: center">
          <p style="color: var(--muted); font-size: 0.9rem; line-height: 1.8">
            ğŸ† Ø³ÙŠØªÙ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù† Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† ÙÙŠ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø¹ÙŠØ¯ Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡<br />ÙˆØ§ØµÙ„
            Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙƒÙ„ ÙŠÙˆÙ… Ù„ØªØ²ÙŠØ¯ ÙØ±ØµØªÙƒ Ø¨Ø§Ù„ÙÙˆØ²!
          </p>
          <button
            class="btn btn-primary"
            style="margin-top: 16px"
            onclick="goBack()"
          >
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </button>
        </div>
      </div>

      <p
        style="
          text-align: center;
          color: var(--muted);
          font-size: 0.75rem;
          margin-top: 20px;
        "
      >
        Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠØ© ğŸŒ™ | ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø°Ù„
      </p>
      <p
        style="
          text-align: center;
          color: var(--muted);
          font-size: 0.75rem;
          margin-top: 20px;
          padding-bottom: 20px;
        "
      >
        Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙˆÙ‡ÙŠØ¯
      </p>
    </div>

    <div class="toast" id="toast"></div>
    <div class="popup-overlay hidden" id="popupOverlay" onclick="closePopup()">
      <div class="popup-box" onclick="event.stopPropagation()">
        <div class="popup-icon" id="popupIcon"></div>
        <div class="popup-title" id="popupTitle"></div>
        <div class="popup-msg" id="popupMsg"></div>
        <button class="popup-btn" onclick="closePopup()">Ø­Ø³Ù†Ø§Ù‹</button>
      </div>
    </div>

    <script>
      const API = "/api";
      let state = {
        participantId: null,
        participantName: null,
        currentDay: 1,
        questions: [],
        currentQ: 0,
        score: 0,
        answers: [],
        timerInterval: null,
        timeLeft: 30,
        quizOpen: false,
        openTime: "21:00",
        closeTime: "22:45",
        historyDays: [],
      };

      /* --- Session --- */
      function saveSession(data) {
        state.participantId = data.participant_id;
        state.participantName = data.name;
      }
      function clearSession() {
        state.participantId = null;
        state.participantName = null;
      }

      /* --- Popup --- */
      function showPopup(icon, title, msg) {
        document.getElementById("popupIcon").textContent = icon;
        document.getElementById("popupTitle").textContent = title;
        document.getElementById("popupMsg").textContent = msg;
        document.getElementById("popupOverlay").classList.remove("hidden");
      }
      function closePopup() {
        document.getElementById("popupOverlay").classList.add("hidden");
      }

      /* --- UI Helpers --- */
      function showToast(msg, type = "") {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.className = "toast" + (type ? " " + type : "");
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 3000);
      }
      function pad(n) {
        return String(n).padStart(2, "0");
      }
      function hideAll() {
        [
          "screenAuth",
          "screenDashboard",
          "screenLeaderboard",
          "screenHistory",
          "screenPrevAnswers",
          "screenQuiz",
          "screenScore",
        ].forEach((id) => document.getElementById(id).classList.add("hidden"));
      }
      function showScreen(id) {
        hideAll();
        document.getElementById(id).classList.remove("hidden");
      }
      function arabicDay(n) {
        const d = [
          "Ø§Ù„Ø£ÙˆÙ„",
          "Ø§Ù„Ø«Ø§Ù†ÙŠ",
          "Ø§Ù„Ø«Ø§Ù„Ø«",
          "Ø§Ù„Ø±Ø§Ø¨Ø¹",
          "Ø§Ù„Ø®Ø§Ù…Ø³",
          "Ø§Ù„Ø³Ø§Ø¯Ø³",
          "Ø§Ù„Ø³Ø§Ø¨Ø¹",
          "Ø§Ù„Ø«Ø§Ù…Ù†",
          "Ø§Ù„ØªØ§Ø³Ø¹",
          "Ø§Ù„Ø¹Ø§Ø´Ø±",
          "Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±",
          "Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±",
          "Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±",
          "Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±",
          "Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±",
          "Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±",
          "Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±",
          "Ø§Ù„Ø«Ø§Ù…Ù† Ø¹Ø´Ø±",
          "Ø§Ù„ØªØ§Ø³Ø¹ Ø¹Ø´Ø±",
          "Ø§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„ÙˆØ§Ø­Ø¯ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø«Ø§Ù†ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø«Ø§Ù„Ø« ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø±Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø®Ø§Ù…Ø³ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø³Ø§Ø¯Ø³ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø³Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø«Ø§Ù…Ù† ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„ØªØ§Ø³Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†",
          "Ø§Ù„Ø«Ù„Ø§Ø«ÙˆÙ†",
        ];
        return n <= 30 ? d[n - 1] : n;
      }

      /* --- API --- */
      async function fetchStatus() {
        try {
          const r = await fetch(`${API}/status`);
          const data = await r.json();
          state.currentDay = data.current_day;
          state.quizOpen = data.is_open;
          state.openTime = data.quiz_open_time;
          state.closeTime = data.quiz_close_time || "22:45";
          document.getElementById("dayBadge").textContent = `Ø§Ù„ÙŠÙˆÙ… ${arabicDay(
            state.currentDay
          )} Ù…Ù† Ø±Ù…Ø¶Ø§Ù†`;
          updateCountdownLabel();
          // Hide countdown skeleton, show real content
          const sk = document.getElementById("skelCountdown");
          if (sk) sk.classList.add("hidden");
          return data;
        } catch (e) {
          const sk = document.getElementById("skelCountdown");
          if (sk) sk.classList.add("hidden");
          return null;
        }
      }

      /* --- Auth --- */
      function switchAuthTab(tab) {
        document
          .querySelectorAll(".auth-tab")
          .forEach((t) => t.classList.remove("active"));
        document
          .querySelectorAll(".auth-panel")
          .forEach((p) => p.classList.remove("active"));
        if (tab === "login") {
          document
            .querySelector(".auth-tab:first-child")
            .classList.add("active");
          document.getElementById("panelLogin").classList.add("active");
        } else {
          document
            .querySelector(".auth-tab:last-child")
            .classList.add("active");
          document.getElementById("panelSignup").classList.add("active");
        }
      }
      async function doLogin() {
        const phone = document.getElementById("loginPhone").value.trim();
        const password = document.getElementById("loginPassword").value;
        if (!phone) {
          showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„", "error");
          return;
        }
        if (!password) {
          showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "error");
          return;
        }
        const btn = document.getElementById("btnLogin");
        btn.disabled = true;
        btn.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¯Ø®ÙˆÙ„...";
        try {
          const r = await fetch(`${API}/login`, {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ phone, password }),
          });
          const data = await r.json();
          if (!r.ok) {
            showToast(data.detail || "Ø­Ø¯Ø« Ø®Ø·Ø£", "error");
            btn.disabled = false;
            btn.textContent = "Ø¯Ø®ÙˆÙ„ ğŸš€";
            return;
          }
          saveSession(data);
          showDashboard();
        } catch (e) {
          showToast("ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
          btn.disabled = false;
          btn.textContent = "Ø¯Ø®ÙˆÙ„ ğŸš€";
        }
      }
      async function doRegister() {
        const name = document.getElementById("inputName").value.trim();
        const phone = document.getElementById("inputPhone").value.trim();
        const password = document.getElementById("inputPassword").value;
        if (!name) {
          showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ", "error");
          return;
        }
        if (!phone) {
          showToast("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ³Ø¬ÙŠÙ„", "error");
          return;
        }
        if (!password) {
          showToast("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©", "error");
          return;
        }
        const btn = document.getElementById("btnRegister");
        btn.disabled = true;
        btn.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
        try {
          const r = await fetch(`${API}/register`, {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, phone, password }),
          });
          const data = await r.json();
          if (!r.ok) {
            showToast(data.detail || "Ø­Ø¯Ø« Ø®Ø·Ø£", "error");
            btn.disabled = false;
            btn.textContent = "Ø³Ø¬Ù‘Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€";
            return;
          }
          saveSession(data);
          showDashboard();
        } catch (e) {
          showToast("ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
          btn.disabled = false;
          btn.textContent = "Ø³Ø¬Ù‘Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€";
        }
      }
      async function doLogout() {
        try {
          await fetch(`${API}/logout`, {
            method: "POST",
            credentials: "include",
          });
        } catch (e) {}
        clearSession();
        // Reset auth form buttons
        const bl = document.getElementById("btnLogin");
        bl.disabled = false;
        bl.textContent = "Ø¯Ø®ÙˆÙ„ ğŸš€";
        const br = document.getElementById("btnRegister");
        br.disabled = false;
        br.textContent = "Ø³Ø¬Ù‘Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€";
        // Clear form inputs
        document.getElementById("loginPhone").value = "";
        document.getElementById("loginPassword").value = "";
        document.getElementById("inputName").value = "";
        document.getElementById("inputPhone").value = "";
        document.getElementById("inputPassword").value = "";
        showScreen("screenAuth");
        document.getElementById("welcomeName").classList.add("hidden");
      }

      /* --- Dashboard --- */
      function showDashboard() {
        showScreen("screenDashboard");
        const wn = document.getElementById("welcomeName");
        wn.textContent = `Ø£Ù‡Ù„Ø§Ù‹ ${state.participantName || ""} ğŸ‘‹`;
        wn.classList.remove("hidden");
        startCountdown();
      }
      function updateCountdownLabel() {
        const [h, m] = state.openTime.split(":");
        const ampm = parseInt(h) >= 12 ? "Ù…Ø³Ø§Ø¡Ù‹" : "ØµØ¨Ø§Ø­Ø§Ù‹";
        const h12 = parseInt(h) > 12 ? parseInt(h) - 12 : parseInt(h);
        document.getElementById(
          "countdownLabel"
        ).textContent = `ØªÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ø§Ø¹Ø© ${h12}:${m} ${ampm}`;
      }
      let countdownStarted = false;
      function tickCountdown() {
        const sk = document.getElementById("skelCountdown");
        const skelVisible = sk && !sk.classList.contains("hidden");
        const now = new Date();
        const [h, m] = state.openTime.split(":");
        const [ch, cm] = (state.closeTime || "22:45").split(":");
        const openT = new Date();
        openT.setHours(parseInt(h), parseInt(m), 0, 0);
        const closeT = new Date();
        closeT.setHours(parseInt(ch), parseInt(cm), 0, 0);
        if (now >= openT && now <= closeT) {
          state.quizOpen = true;
          document.getElementById("dashCountdown").classList.add("hidden");
          if (!skelVisible)
            document.getElementById("dashOpenBadge").classList.remove("hidden");
          return;
        }
        state.quizOpen = false;
        if (!skelVisible)
          document.getElementById("dashCountdown").classList.remove("hidden");
        document.getElementById("dashOpenBadge").classList.add("hidden");
        let nextOpen = new Date();
        nextOpen.setHours(parseInt(h), parseInt(m), 0, 0);
        if (now >= nextOpen) nextOpen.setDate(nextOpen.getDate() + 1);
        const diff = nextOpen - now;
        document.getElementById("cdHours").textContent = pad(
          Math.floor(diff / 3600000)
        );
        document.getElementById("cdMins").textContent = pad(
          Math.floor((diff % 3600000) / 60000)
        );
        document.getElementById("cdSecs").textContent = pad(
          Math.floor((diff % 60000) / 1000)
        );
      }
      function startCountdown() {
        if (countdownStarted) return;
        countdownStarted = true;
        tickCountdown(); // Run immediately â€” no 1s delay
        setInterval(() => {
          fetchStatus().catch(() => null);
        }, 30000);
        setInterval(tickCountdown, 1000);
      }

      /* --- Navigation --- */
      function goBack() {
        showScreen("screenDashboard");
      }

      async function goToChallenge() {
        if (!state.quizOpen) {
          showToast("Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø§Ù†ØªØ¸Ø± ÙˆÙ‚Øª Ø§Ù„Ø§ÙØªØªØ§Ø­", "error");
          return;
        }
        try {
          const r = await fetch(`${API}/check-day/${state.currentDay}`, {
            credentials: "include",
          });
          if (r.status === 401) {
            doLogout();
            showToast("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©ØŒ Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹", "error");
            return;
          }
          const data = await r.json();
          if (data.answered) {
            showPopup(
              "âœ…",
              "Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙŠÙˆÙ…!",
              "Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„ ğŸ‰\nØ¹ÙØ¯ ØºØ¯Ø§Ù‹ Ù„Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©!"
            );
            return;
          }
        } catch (e) {}
        await loadAndStartQuiz();
      }

      async function goToLeaderboard() {
        showScreen("screenLeaderboard");
        const sk = document.getElementById("skelLeaderboard");
        sk.classList.remove("hidden");
        document.getElementById("lbPageList").innerHTML = "";
        document.getElementById("lbEmpty").classList.add("hidden");
        try {
          const r = await fetch(`${API}/leaderboard`);
          const data = await r.json();
          sk.classList.add("hidden");
          const list = document.getElementById("lbPageList");
          const empty = document.getElementById("lbEmpty");
          if (!data.length) {
            list.innerHTML = "";
            empty.classList.remove("hidden");
            return;
          }
          empty.classList.add("hidden");
          const medals = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];
          list.innerHTML = data
            .map((item) => {
              const medal = item.rank <= 3 ? medals[item.rank - 1] : item.rank;
              const tc = item.rank <= 3 ? " top-3" : "";
              return `<div class="lb-row${tc}"><div class="lb-rank">${medal}</div><div class="lb-points">${item.points} <span>Ù†Ù‚Ø·Ø©</span></div></div>`;
            })
            .join("");
        } catch (e) {
          sk.classList.add("hidden");
          showToast("ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†", "error");
        }
      }

      async function goToHistory() {
        showScreen("screenHistory");
        const sk = document.getElementById("skelHistory");
        sk.classList.remove("hidden");
        document.getElementById("historyList").innerHTML = "";
        document.getElementById("historyEmpty").classList.add("hidden");
        try {
          const r = await fetch(`${API}/my-history`, {
            credentials: "include",
          });
          sk.classList.add("hidden");
          if (r.status === 401) {
            doLogout();
            showToast("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©", "error");
            return;
          }
          const data = await r.json();
          state.historyDays = data;
          const list = document.getElementById("historyList");
          const empty = document.getElementById("historyEmpty");
          if (!data.length) {
            list.innerHTML = "";
            empty.classList.remove("hidden");
            return;
          }
          empty.classList.add("hidden");
          list.innerHTML = data
            .map(
              (d) =>
                `<div class="history-row"><div><div class="day-label">Ø§Ù„ÙŠÙˆÙ… ${arabicDay(
                  d.day
                )}</div><div class="day-info">${
                  d.answered_count
                } Ø¥Ø¬Ø§Ø¨Ø©</div></div><div class="day-action" onclick="viewDayAnswers(${
                  d.day
                })">Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</div></div>`
            )
            .join("");
        } catch (e) {
          sk.classList.add("hidden");
          showToast("ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„", "error");
        }
      }

      async function goToPrevAnswers() {
        showScreen("screenPrevAnswers");
        const sk = document.getElementById("skelPrevAnswers");
        sk.classList.remove("hidden");
        document.getElementById("prevDaySelector").innerHTML = "";
        document.getElementById("prevAnswersList").innerHTML = "";
        document.getElementById("prevAnswersEmpty").classList.add("hidden");
        try {
          const r = await fetch(`${API}/my-history`, {
            credentials: "include",
          });
          if (r.status === 401) {
            doLogout();
            showToast("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©", "error");
            return;
          }
          const data = await r.json();
          sk.classList.add("hidden");
          state.historyDays = data;
          const sel = document.getElementById("prevDaySelector");
          const list = document.getElementById("prevAnswersList");
          const empty = document.getElementById("prevAnswersEmpty");
          if (!data.length) {
            sel.innerHTML = "";
            list.innerHTML = "";
            empty.classList.remove("hidden");
            empty.textContent = "Ù„Ù… ØªØ´Ø§Ø±Ùƒ ÙÙŠ Ø£ÙŠ ÙŠÙˆÙ… Ø¨Ø¹Ø¯";
            return;
          }
          empty.classList.remove("hidden");
          empty.textContent = "Ø§Ø®ØªØ± ÙŠÙˆÙ…Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ";
          list.innerHTML = "";
          sel.innerHTML = data
            .map(
              (d) =>
                `<button class="back-btn" style="margin:0;" onclick="viewDayAnswers(${d.day})">Ø§Ù„ÙŠÙˆÙ… ${d.day}</button>`
            )
            .join("");
        } catch (e) {
          sk.classList.add("hidden");
          showToast("ØªØ¹Ø°Ù‘Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„", "error");
        }
      }

      async function viewDayAnswers(day) {
        showScreen("screenPrevAnswers");
        document.getElementById(
          "prevAnswersTitle"
        ).textContent = `ğŸ“ Ø¥Ø¬Ø§Ø¨Ø§ØªÙŠ - Ø§Ù„ÙŠÙˆÙ… ${arabicDay(day)}`;
        const sel = document.getElementById("prevDaySelector");
        sel.innerHTML = state.historyDays
          .map(
            (d) =>
              `<button class="back-btn${
                d.day === day ? " active-day" : ""
              }" style="margin:0;" onclick="viewDayAnswers(${d.day})">Ø§Ù„ÙŠÙˆÙ… ${
                d.day
              }</button>`
          )
          .join("");
        const list = document.getElementById("prevAnswersList");
        const empty = document.getElementById("prevAnswersEmpty");
        try {
          const r = await fetch(`${API}/my-answers/${day}`, {
            credentials: "include",
          });
          if (r.status === 401) {
            doLogout();
            showToast("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©", "error");
            return;
          }
          const data = await r.json();
          if (!data.length) {
            list.innerHTML = "";
            empty.classList.remove("hidden");
            empty.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…";
            return;
          }
          empty.classList.add("hidden");
          const arabicLetters = ["Ø£", "Ø¨", "Ø¬", "Ø¯", "Ù‡Ù€", "Ùˆ"];
          list.innerHTML = data
            .map((a, i) => {
              let ansText = a.selected_answer;
              if (
                a.question_type !== "fill_blank" &&
                a.options &&
                a.options.length
              ) {
                const idx = parseInt(a.selected_answer);
                if (!isNaN(idx) && a.options[idx]) ansText = a.options[idx];
              }
              return `<div class="prev-answer-card"><div class="pa-q">${
                i + 1
              }. ${a.question_text}</div><div class="pa-a">Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${
                ansText || "Ù„Ù… ØªØ¬Ø¨"
              }</div></div>`;
            })
            .join("");
        } catch (e) {
          showToast("ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª", "error");
        }
      }

      /* --- Quiz --- */
      async function loadAndStartQuiz() {
        try {
          const r = await fetch(`${API}/questions/${state.currentDay}`);
          state.questions = await r.json();
          if (!state.questions.length) {
            showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø¹Ø¯", "error");
            return;
          }
          showScreen("screenQuiz");
          state.answers = [];
          state.currentQ = 0;
          buildProgressBar();
          showQuestion(0);
        } catch (e) {
          showToast("ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©", "error");
        }
      }
      function buildProgressBar() {
        const bar = document.getElementById("quizProgressBar");
        bar.innerHTML = "";
        state.questions.forEach((_, i) => {
          const d = document.createElement("div");
          d.className = "qpb-item" + (i === 0 ? " active" : "");
          d.id = `qpb_${i}`;
          bar.appendChild(d);
        });
      }
      function updateProgressBar(idx) {
        document.querySelectorAll(".qpb-item").forEach((el, i) => {
          el.className = "qpb-item";
          if (i <= idx) el.classList.add("done-correct");
          else if (i === idx + 1) el.classList.add("active");
        });
      }
      function showQuestion(idx) {
        const q = state.questions[idx];
        state.currentQ = idx;
        state.timeLeft = 30;
        document.getElementById("questionProgress").textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${
          idx + 1
        } Ù…Ù† ${state.questions.length}`;
        document.getElementById("questionCategory").textContent =
          q.category === "quran"
            ? "ğŸ“– Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…"
            : q.category === "ramadan"
            ? "ğŸŒ™ Ø±Ù…Ø¶Ø§Ù†"
            : "Ø¹Ø§Ù…";
        document.getElementById("questionText").textContent = q.question_text;
        document.getElementById("answerFeedback").className = "answer-feedback";
        document.getElementById("answerFeedback").textContent = "";
        const container = document.getElementById("optionsContainer");
        container.innerHTML = "";
        const qtype = q.question_type || "multiple_choice";
        if (qtype === "fill_blank") {
          container.innerHTML = `<input type="text" class="fill-blank-input" id="fillBlankInput" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..." onkeydown="if(event.key==='Enter')submitFillBlank()" /><button class="fill-blank-submit" id="fillBlankBtn" onclick="submitFillBlank()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>`;
        } else {
          const opts = q.options || [];
          const letters = ["Ø£", "Ø¨", "Ø¬", "Ø¯", "Ù‡Ù€", "Ùˆ"];
          opts.forEach((text, i) => {
            const div = document.createElement("div");
            div.className = "option";
            div.dataset.index = String(i);
            div.onclick = () => selectAnswer(String(i), q);
            const letter =
              qtype === "true_false"
                ? i === 0
                  ? "âœ“"
                  : "âœ•"
                : letters[i] || String(i + 1);
            div.innerHTML = `<span class="option-letter">${letter}</span>${text}`;
            container.appendChild(div);
          });
        }
        startTimer(q);
      }
      function startTimer(q) {
        clearInterval(state.timerInterval);
        updateTimer(30);
        state.timerInterval = setInterval(() => {
          state.timeLeft--;
          updateTimer(state.timeLeft);
          if (state.timeLeft <= 0) {
            clearInterval(state.timerInterval);
            autoAnswer(q);
          }
        }, 1000);
      }
      function updateTimer(t) {
        const bar = document.getElementById("timerBar");
        const num = document.getElementById("timerNum");
        bar.style.width = (t / 30) * 100 + "%";
        num.textContent = t;
        bar.className =
          "timer-bar" + (t <= 10 ? " danger" : t <= 15 ? " warning" : "");
        num.className =
          "timer-num" + (t <= 10 ? " danger" : t <= 15 ? " warning" : "");
      }
      async function autoAnswer(q) {
        const qtype = q.question_type || "multiple_choice";
        if (qtype === "fill_blank") {
          const inp = document.getElementById("fillBlankInput");
          const btn = document.getElementById("fillBlankBtn");
          if (inp) inp.disabled = true;
          if (btn) btn.disabled = true;
        } else {
          document
            .querySelectorAll(".option")
            .forEach((el) => el.classList.add("disabled"));
        }
        await submitAnswer(q.id, "", 30);
        state.answers.push(false);
        updateProgressBar(state.currentQ);
        setTimeout(() => nextQuestion(), 800);
      }
      async function submitFillBlank() {
        const q = state.questions[state.currentQ];
        const inp = document.getElementById("fillBlankInput");
        const btn = document.getElementById("fillBlankBtn");
        const val = inp.value.trim();
        if (!val) {
          showToast("Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹", "error");
          return;
        }
        clearInterval(state.timerInterval);
        const timeTaken = 30 - state.timeLeft;
        inp.disabled = true;
        btn.disabled = true;
        try {
          await submitAnswer(q.id, val, timeTaken);
          state.answers.push(true);
          updateProgressBar(state.currentQ);
          setTimeout(() => nextQuestion(), 800);
        } catch (e) {
          showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "error");
          inp.disabled = false;
          btn.disabled = false;
        }
      }
      async function selectAnswer(val, q) {
        clearInterval(state.timerInterval);
        const timeTaken = 30 - state.timeLeft;
        document
          .querySelectorAll(".option")
          .forEach((el) => el.classList.add("disabled"));
        const sel = [...document.querySelectorAll(".option")].find(
          (el) => el.dataset.index === val
        );
        if (sel) sel.classList.add("selected");
        try {
          await submitAnswer(q.id, val, timeTaken);
          state.answers.push(true);
          updateProgressBar(state.currentQ);
          setTimeout(() => nextQuestion(), 800);
        } catch (e) {
          showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "error");
        }
      }
      async function submitAnswer(qid, val, timeTaken) {
        await fetch(`${API}/answer`, {
          method: "POST",
          credentials: "include",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            question_id: qid,
            selected_answer: val || "none",
            time_taken: timeTaken,
          }),
        });
      }
      function nextQuestion() {
        const next = state.currentQ + 1;
        if (next < state.questions.length) showQuestion(next);
        else showScore();
      }
      async function showScore() {
        showScreen("screenScore");
        const statsEl = document.getElementById("summaryStats");
        const listEl = document.getElementById("summaryList");
        statsEl.innerHTML = "";
        listEl.innerHTML =
          '<div class="skeleton skel-line w80"></div><div class="skeleton skel-line w60"></div><div class="skeleton skel-line w80"></div>';
        try {
          const r = await fetch(`${API}/my-answers/${state.currentDay}`, {
            credentials: "include",
          });
          if (!r.ok) throw new Error();
          const data = await r.json();
          const correct = data.filter((a) => a.is_correct === 1).length;
          const wrong = data.length - correct;
          statsEl.innerHTML = `
            <div class="summary-stat"><span class="num">${data.length}</span><span class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span></div>
            <div class="summary-stat"><span class="num green">${correct}</span><span class="lbl">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</span></div>
            <div class="summary-stat"><span class="num red">${wrong}</span><span class="lbl">Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©</span></div>
          `;
          listEl.innerHTML = data
            .map((a, i) => {
              const isCorrect = a.is_correct === 1;
              const cls = isCorrect ? "correct" : "wrong";
              const badgeText = isCorrect ? "âœ“ ØµØ­ÙŠØ­Ø©" : "âœ• Ø®Ø§Ø·Ø¦Ø©";
              let yourAns = a.selected_answer || "Ù„Ù… ØªØ¬Ø¨";
              let correctAns = a.correct_answer || "";
              const opts = a.options || [];
              if (a.question_type !== "fill_blank" && opts.length) {
                const idx = parseInt(a.selected_answer);
                if (!isNaN(idx) && opts[idx]) yourAns = opts[idx];
                const cIdx = parseInt(a.correct_answer);
                if (!isNaN(cIdx) && opts[cIdx]) correctAns = opts[cIdx];
              }
              let html = `<div class="summary-card ${cls}">`;
              html += `<div class="summary-q">${i + 1}. ${
                a.question_text
              }</div>`;
              html += `<div class="summary-row"><span class="summary-badge ${cls}">${badgeText}</span><span class="summary-your">Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${yourAns}</span></div>`;
              if (!isCorrect) {
                html += `<div class="summary-row"><span class="summary-correct-ans">âœ“ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAns}</span></div>`;
              }
              html += `</div>`;
              return html;
            })
            .join("");
        } catch (e) {
          listEl.innerHTML =
            '<p style="text-align:center;color:var(--muted)">ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø®Øµ</p>';
        }
      }

      /* --- Init --- */
      // Show correct screen IMMEDIATELY (sync, no waiting)
      if (window.__SESSION__) {
        saveSession(window.__SESSION__);
        showDashboard();
      } else {
        clearSession();
        showScreen("screenAuth");
      }
      // Then fetch status in background to update countdown/open state
      fetchStatus().catch(() => null);
    </script>
  </body>
</html>
